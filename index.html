<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Pedidos - UMADEMATS</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ===== VARIÁVEIS E RESET (Mantidas) ===== */
    :root {
      --primary-color: #ff7e5f;
      --primary-dark: #ff6b47;
      --secondary-color: #feb47b;
      --accent-color: #ffd4a3;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --dark-color: #062C3F;
      --darker-color: #042035;
      --light-color: #f8fafc;
      --white-color: #ffffff;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --text-color: #1f2937;
      --text-muted: #6b7280;
      --border-color: #d1d5db;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: var(--gray-50);
      color: var(--text-color);
      line-height: 1.6;
    }

    /* ===== ESTRUTURA GERAL ===== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background-color: var(--white-color);
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      position: relative;
    }

    .header h1 {
      color: var(--primary-color);
      font-weight: 800;
      margin-bottom: 5px;
    }

    .header p {
      color: var(--text-muted);
      font-weight: 500;
    }
    
    /* ===== BOTÕES E LINKS ===== */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .btn i {
        margin-right: 8px;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: var(--white-color);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: var(--dark-color);
      border: 1px solid var(--secondary-color);
    }

    .btn-secondary:hover {
      background-color: #f7a96e;
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .btn-link {
        background: none;
        color: var(--text-muted);
        padding: 8px 16px;
    }
    
    .btn-link:hover {
        color: var(--primary-color);
        background-color: var(--gray-100);
    }
    
    .btn-danger {
        background-color: var(--danger-color);
        color: var(--white-color);
    }
    
    .btn-danger:hover {
        background-color: #cc3939;
    }

    /* ===== SEÇÕES DA PÁGINA (Home, Pedido, Consulta, Admin) ===== */
    .section-content {
      background-color: var(--white-color);
      padding: 30px;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      margin-bottom: 20px;
    }

    .section-content h2 {
      color: var(--dark-color);
      font-weight: 700;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--gray-200);
      padding-bottom: 10px;
      display: flex;
      align-items: center;
    }

    .section-content h2 i {
        margin-right: 10px;
        color: var(--primary-color);
    }

    /* ===== HOME (Página Inicial) ===== */
    #home .btn-group {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }

    /* ===== FORMULÁRIO GERAL (Fazer Pedido) ===== */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }
    
    .form-group label i {
        margin-right: 6px;
        color: var(--text-muted);
    }

    .form-group input:not([type="checkbox"]), .form-group select {
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(255, 126, 95, 0.2);
    }
    
    .form-group input[type="number"] {
        appearance: textfield; /* Remove arrows from number input */
    }

    /* Estilos para a tabela de tamanhos */
    .tamanhos-section {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid var(--gray-200);
      border-radius: 10px;
      background-color: var(--gray-50);
    }

    .tamanhos-section h3 {
        color: var(--dark-color);
        margin-bottom: 15px;
        font-weight: 600;
        border-bottom: 1px dashed var(--gray-200);
        padding-bottom: 10px;
    }

    .tamanhos-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 15px;
    }

    .tamanhos-grid-tipo {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        background-color: var(--white-color);
        box-shadow: var(--shadow-sm);
    }

    .tamanhos-grid-tipo h4 {
        margin-bottom: 15px;
        font-weight: 700;
        color: var(--dark-color);
        text-align: center;
        padding-bottom: 5px;
        border-bottom: 2px solid var(--secondary-color);
    }

    .tamanhos-grid-tamanho {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 5px 0;
        border-bottom: 1px dotted var(--gray-100);
    }

    .tamanhos-grid-tamanho:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .tamanhos-grid-tamanho label {
        font-weight: 500;
        margin-bottom: 0;
        color: var(--text-color);
    }

    .tamanhos-grid-tamanho input[type="number"] {
        width: 70px;
        text-align: center;
        padding: 6px;
    }

    /* ===== MENSAGENS E FEEDBACK ===== */
    .message-container {
      margin-top: 20px;
      min-height: 20px; /* Garante espaço */
    }
    
    .mensagem {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }

    .mensagem i {
        margin-right: 10px;
        font-size: 1.1em;
    }
    
    .sucesso {
      background-color: #d1fae5;
      color: var(--success-color);
      border: 1px solid #a7f3d0;
    }

    .erro {
      background-color: #fee2e2;
      color: var(--danger-color);
      border: 1px solid #fecaca;
    }

    .aviso {
      background-color: #fef3c7;
      color: var(--warning-color);
      border: 1px solid #fde68a;
    }

    /* ===== CARREGAMENTO (Spinner) ===== */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
    }

    .spinner {
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-top: 6px solid var(--secondary-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    #loading-text {
        color: var(--white-color);
        margin-top: 15px;
        font-weight: 600;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ===== CONSULTA E CONFIRMAÇÃO DE PEDIDO (Nova Lógica) ===== */
    .consulta-pedido-container, .confirmacao-pedido-container {
        padding: 30px;
        background-color: var(--gray-50);
        border-radius: 12px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
        margin-top: 20px;
    }

    .resumo-pedido-body {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        background-color: var(--white-color);
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .resumo-detail-item {
        display: flex;
        justify-content: space-between;
        padding-bottom: 5px;
        border-bottom: 1px dotted var(--gray-100);
    }
    
    .resumo-detail-item .label {
        font-weight: 500;
        color: var(--text-muted);
    }
    
    .resumo-detail-item .value {
        font-weight: 600;
        color: var(--text-color);
    }

    /* Estilo para a linha do Valor Total (novo) */
    .resumo-detail-item.total-value-line {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 2px solid var(--secondary-color);
        border-bottom: none;
    }

    .resumo-detail-item.total-value-line .label {
        font-size: 1.1em;
        font-weight: 700;
        color: var(--dark-color);
    }

    .resumo-detail-item.total-value-line .value.price-value {
        font-size: 1.2em;
        font-weight: 800;
        color: var(--primary-color);
    }


    /* Tabela de Detalhes de Tamanhos */
    .resumo-tamanhos table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    
    .resumo-tamanhos th, .resumo-tamanhos td {
        padding: 10px;
        border: 1px solid var(--gray-200);
        text-align: center;
    }
    
    .resumo-tamanhos th {
        background-color: var(--primary-color);
        color: var(--white-color);
        font-weight: 600;
    }

    .resumo-tamanhos tr:nth-child(even) {
        background-color: var(--gray-50);
    }

    .resumo-tamanhos h4 {
        margin-top: 20px;
        color: var(--primary-dark);
        font-weight: 600;
    }


    /* ===== PAINEL ADMINISTRATIVO ===== */
    #painelAdmin {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      margin-top: 20px;
      flex-grow: 1; /* Permite que o painel cresça */
    }

    .admin-menu {
      width: 250px;
      min-height: 400px;
      background-color: var(--white-color);
      padding: 15px;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      flex-shrink: 0;
      position: sticky;
      top: 20px; /* Fixa o menu ao rolar */
    }

    .admin-menu-btn {
      width: 100%;
      text-align: left;
      padding: 12px 15px;
      margin-bottom: 8px;
      background: none;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s;
      display: flex;
      align-items: center;
    }

    .admin-menu-btn i {
      margin-right: 10px;
      font-size: 1.1em;
    }

    .admin-menu-btn:hover {
      background-color: var(--gray-100);
      color: var(--primary-color);
    }

    .admin-menu-btn.active {
      background-color: var(--primary-color);
      color: var(--white-color);
      box-shadow: var(--shadow-sm);
    }

    .admin-menu-btn.active:hover {
        background-color: var(--primary-dark);
        color: var(--white-color);
    }

    .admin-content {
      flex-grow: 1;
      min-width: 0;
    }

    .admin-section {
      background-color: var(--white-color);
      padding: 30px;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      margin-bottom: 20px;
      display: none;
    }
    
    .admin-section.active {
        display: block;
    }

    .dashboard-header, .admin-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--gray-200);
    }
    
    .dashboard-header h3, .admin-section-header h3 {
        color: var(--dark-color);
        font-weight: 700;
    }

    .btn-refresh {
        background: none;
        border: 1px solid var(--border-color);
        padding: 8px 15px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        color: var(--text-muted);
        transition: all 0.2s;
    }

    .btn-refresh:hover {
        background-color: var(--gray-100);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }
    
    /* DASHBOARD */
    .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .card {
        background-color: var(--gray-50);
        padding: 20px;
        border-radius: 10px;
        box-shadow: var(--shadow-sm);
        display: flex;
        align-items: center;
        border-left: 5px solid var(--primary-color);
    }
    
    .card-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: var(--white-color);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5em;
        margin-right: 15px;
    }
    
    .card-content h4 {
        color: var(--text-muted);
        font-size: 0.9em;
        font-weight: 500;
        margin-bottom: 4px;
    }
    
    .card-content .card-value {
        font-size: 2em;
        font-weight: 800;
        color: var(--dark-color);
    }
    
    /* PEDIDOS (ADMIN) */
    .pedidos-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .pedido-item {
        padding: 15px;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        background-color: var(--gray-50);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
    }

    .pedido-item:hover {
        border-color: var(--secondary-color);
        box-shadow: var(--shadow-sm);
    }
    
    .pedido-info h5 {
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 5px;
    }
    
    .pedido-info p {
        font-size: 0.9em;
        color: var(--text-muted);
    }
    
    .pedido-status {
        font-weight: 700;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.85em;
    }

    .status-Pendente {
        background-color: #fef3c7;
        color: var(--warning-color);
    }

    .status-Aprovado {
        background-color: #d1fae5;
        color: var(--success-color);
    }

    .status-Rejeitado {
        background-color: #fee2e2;
        color: var(--danger-color);
    }

    .pedido-actions {
        display: flex;
        gap: 10px;
    }
    
    /* DETALHES DE TAMANHOS (ADMIN) */
    .details-tamanhos-table table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .details-tamanhos-table th, .details-tamanhos-table td {
        padding: 12px;
        border: 1px solid var(--gray-200);
        text-align: center;
        font-size: 0.95em;
    }
    
    .details-tamanhos-table th {
        background-color: var(--dark-color);
        color: var(--white-color);
        font-weight: 600;
    }

    .details-tamanhos-table tr:nth-child(even) {
        background-color: var(--gray-50);
    }
    
    /* Estilos Adicionais para a Tabela de Detalhes de Tamanhos */
    .details-tamanhos-table h4 {
        margin-top: 25px;
        font-weight: 700;
        color: var(--primary-dark);
        border-bottom: 1px dashed var(--gray-200);
        padding-bottom: 5px;
    }

    /* ESTILO PARA A SEÇÃO FINANCEIRO (NOVO) */
    .modern-form {
        padding: 20px;
        border: 1px solid var(--gray-200);
        border-radius: 10px;
        background-color: var(--gray-50);
        box-shadow: var(--shadow-sm);
    }

    .modern-form h4 {
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px dashed var(--border-color);
    }

    .dashboard-details {
        margin-top: 30px;
    }

    .dashboard-details h4 {
        margin-bottom: 15px;
        font-weight: 700;
        color: var(--dark-color);
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary-color);
    }

    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .detail-item {
        background-color: var(--white-color);
        padding: 15px;
        border-radius: 8px;
        box-shadow: var(--shadow-sm);
        display: flex;
        align-items: center;
        border-left: 4px solid var(--secondary-color);
    }

    .detail-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: rgba(254, 180, 123, 0.2);
        color: var(--primary-color);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2em;
        margin-right: 15px;
    }

    .detail-content span, .detail-content strong {
        display: block;
    }

    .detail-content strong {
        margin-top: 3px;
    }

    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }

        .tamanhos-grid {
            grid-template-columns: 1fr;
        }

        .dashboard-cards {
            grid-template-columns: 1fr;
        }
        
        #painelAdmin {
            flex-direction: column;
        }

        .admin-menu {
            width: 100%;
            position: static;
        }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

  <div id="loading-overlay">
    <div class="spinner"></div>
    <span id="loading-text">Carregando...</span>
  </div>

  <div class="container">

    <header class="header">
      <h1>UMADEMATS - Pedido de Camisetas</h1>
      <p>Faça seu pedido ou consulte o status com seu CPF.</p>
      <button class="btn-link" id="btnAdminAccess" style="position: absolute; top: 10px; right: 10px;">
          <i class="fas fa-cog"></i>
          Admin
      </button>
    </header>

    <section id="home" class="section-content">
      <h2><i class="fas fa-home"></i> Bem-vindo(a)</h2>
      <p>Utilize as opções abaixo para iniciar um novo pedido ou verificar o status de um pedido já realizado.</p>
      <div class="btn-group">
        <button class="btn btn-primary" id="btnFazerPedido">
          <i class="fas fa-cart-plus"></i>
          Fazer Pedido
        </button>
        <button class="btn btn-secondary" id="btnConsultarPedido">
          <i class="fas fa-search"></i>
          Consultar Pedido
        </button>
      </div>
      <div id="mensagemHome" class="message-container"></div>
    </section>

    <section id="fazer-pedido" class="section-content" style="display: none;">
      <h2><i class="fas fa-tshirt"></i> Formulário de Pedido</h2>
      <form id="formPedido">
        
        <div class="form-grid">
            <div class="form-group">
                <label for="nome"><i class="fas fa-user"></i> Nome Completo</label>
                <input type="text" id="nome" required>
            </div>
            <div class="form-group">
                <label for="cpf"><i class="fas fa-id-card"></i> CPF</label>
                <input type="text" id="cpf" required pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" placeholder="000.000.000-00">
            </div>
            <div class="form-group">
                <label for="local"><i class="fas fa-city"></i> Cidade/Local</label>
                <input type="text" id="local" required placeholder="Ex: Campo Grande, Dourados, etc.">
            </div>
            <div class="form-group">
                <label for="setor"><i class="fas fa-map-marker-alt"></i> Setor (Apenas p/ Capital) / Bairro</label>
                <input type="text" id="setor" required placeholder="Ex: Setor Monte Líbano, Bairro Tal">
            </div>
        </div>

        <div class="tamanhos-section">
            <h3><i class="fas fa-ruler-combined"></i> Quantidade por Tamanho</h3>
            <div class="tamanhos-grid">
                
                <div class="tamanhos-grid-tipo">
                    <h4>Infantil</h4>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_2">Tam 2</label>
                        <input type="number" id="infantil_2" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_4">Tam 4</label>
                        <input type="number" id="infantil_4" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_6">Tam 6</label>
                        <input type="number" id="infantil_6" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_8">Tam 8</label>
                        <input type="number" id="infantil_8" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_10">Tam 10</label>
                        <input type="number" id="infantil_10" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="infantil_12">Tam 12</label>
                        <input type="number" id="infantil_12" min="0" value="0">
                    </div>
                </div>

                <div class="tamanhos-grid-tipo">
                    <h4>Babylook Feminina</h4>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_p">P</label>
                        <input type="number" id="babylook_p" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_m">M</label>
                        <input type="number" id="babylook_m" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_g">G</label>
                        <input type="number" id="babylook_g" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_gg">GG</label>
                        <input type="number" id="babylook_gg" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_xg">XG</label>
                        <input type="number" id="babylook_xg" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="babylook_g1">G1</label>
                        <input type="number" id="babylook_g1" min="0" value="0">
                    </div>
                </div>

                <div class="tamanhos-grid-tipo">
                    <h4>Unissex</h4>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_p">P</label>
                        <input type="number" id="unissex_p" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_m">M</label>
                        <input type="number" id="unissex_m" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_g">G</label>
                        <input type="number" id="unissex_g" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_gg">GG</label>
                        <input type="number" id="unissex_gg" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_xg">XG</label>
                        <input type="number" id="unissex_xg" min="0" value="0">
                    </div>
                    <div class="tamanhos-grid-tamanho">
                        <label for="unissex_g1">G1</label>
                        <input type="number" id="unissex_g1" min="0" value="0">
                    </div>
                </div>

            </div>
        </div>

        <div id="mensagemPedido" class="message-container"></div>
        
        <div class="btn-group" style="margin-top: 30px; justify-content: flex-start;">
            <button type="submit" class="btn btn-primary" id="btnSalvarPedido">
                <i class="fas fa-check"></i>
                Finalizar Pedido
            </button>
            <button type="button" class="btn btn-link" id="btnCancelarPedido">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
        </div>
      </form>
    </section>

    <section id="consulta-pedido" class="section-content" style="display: none;">
      <h2><i class="fas fa-search"></i> Consultar Pedido</h2>
      
      <form id="formConsulta">
        <div class="form-group">
            <label for="cpfConsulta"><i class="fas fa-id-card"></i> Digite seu CPF para consultar</label>
            <input type="text" id="cpfConsulta" required pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" placeholder="000.000.000-00">
        </div>
        <div id="mensagemConsulta" class="message-container"></div>
        <div class="btn-group" style="justify-content: flex-start; margin-top: 20px;">
            <button type="submit" class="btn btn-secondary">
                <i class="fas fa-search"></i>
                Buscar Pedido
            </button>
            <button type="button" class="btn btn-link" id="voltarHomeConsulta">
                <i class="fas fa-home"></i>
                Voltar
            </button>
        </div>
      </form>

      <div id="resumoPedido" class="consulta-pedido-container" style="display: none;">
          <h3><i class="fas fa-file-alt" style="color: var(--secondary-color);"></i> Resumo do Pedido</h3>
          <div id="resumoPedidoBody" class="resumo-pedido-body">
              </div>
          <div class="btn-group" style="justify-content: flex-start; margin-top: 20px;">
              <button type="button" class="btn btn-link" id="fecharResumoConsulta">
                  <i class="fas fa-undo-alt"></i>
                  Nova Consulta
              </button>
          </div>
      </div>
    </section>

    <section id="confirmacao-pedido" class="section-content" style="display: none;">
        <h2><i class="fas fa-clipboard-check"></i> Pedido Finalizado com Sucesso!</h2>
        <div class="confirmacao-pedido-container">
            <p style="font-size: 1.1em; font-weight: 600; color: var(--success-color);">Seu pedido foi registrado. O status inicial é <span class="pedido-status status-Pendente">Pendente</span>.</p>
            <p style="margin-top: 10px; color: var(--text-color);">Utilize seu CPF para acompanhar o status na seção "Consultar Pedido".</p>
            
            <h3 style="margin-top: 20px;"><i class="fas fa-info-circle" style="color: var(--success-color);"></i> Detalhes do Seu Pedido:</h3>
            <div id="confirmacaoPedidoBody" class="resumo-pedido-body">
                </div>
            
            <div class="btn-group" style="justify-content: flex-start; margin-top: 30px;">
                <button class="btn btn-primary" id="fecharConfirmacaoPedido">
                    <i class="fas fa-home"></i>
                    Voltar ao Início
                </button>
            </div>
        </div>
    </section>

    <div id="painelAdmin" class="admin-panel" style="display: none;">
      
      <div class="admin-menu">
          <button class="admin-menu-btn active" id="btnDashboard">
              <i class="fas fa-chart-pie"></i>
              Dashboard
          </button>
          <button class="admin-menu-btn" id="btnPedidos">
              <i class="fas fa-list"></i>
              Pedidos
          </button>
          <button class="admin-menu-btn" id="btnFinanceiro">
              <i class="fas fa-dollar-sign"></i>
              Financeiro
          </button>
          <button class="admin-menu-btn btn-danger" id="btnLogoutAdmin" style="margin-top: 20px;">
              <i class="fas fa-sign-out-alt"></i>
              Sair
          </button>
      </div>

      <div class="admin-content">
          
          <div id="admin-dashboard" class="admin-section active">
              <div class="dashboard-header">
                  <h3>Visão Geral</h3>
                  <button id="atualizarDashboard" class="btn-refresh">
                      <i class="fas fa-sync-alt"></i>
                      Atualizar
                  </button>
              </div>

              <div class="dashboard-cards">
                  <div class="card" style="border-left-color: var(--primary-color);">
                      <div class="card-icon" style="background-color: var(--primary-color);">
                          <i class="fas fa-boxes"></i>
                      </div>
                      <div class="card-content">
                          <h4>Total de Camisetas</h4>
                          <p class="card-value" id="totalCamisetas">0</p>
                      </div>
                  </div>
                  <div class="card" style="border-left-color: var(--secondary-color);">
                      <div class="card-icon" style="background-color: var(--secondary-color);">
                          <i class="fas fa-file-alt"></i>
                      </div>
                      <div class="card-content">
                          <h4>Total de Pedidos</h4>
                          <p class="card-value" id="totalPedidos">0</p>
                      </div>
                  </div>
                  <div class="card" style="border-left-color: var(--warning-color);">
                      <div class="card-icon" style="background-color: var(--warning-color);">
                          <i class="fas fa-clock"></i>
                      </div>
                      <div class="card-content">
                          <h4>Pedidos Pendentes</h4>
                          <p class="card-value" id="pedidosPendentes">0</p>
                      </div>
                  </div>
                  <div class="card" style="border-left-color: var(--success-color);">
                      <div class="card-icon" style="background-color: var(--success-color);">
                          <i class="fas fa-check-circle"></i>
                      </div>
                      <div class="card-content">
                          <h4>Pedidos Aprovados</h4>
                          <p class="card-value" id="pedidosAprovados">0</p>
                      </div>
                  </div>
                  <div class="card" style="background: rgba(254, 180, 123, 0.1); border-left-color: var(--primary-dark);"> 
                      <div class="card-icon" style="background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));">
                          <i class="fas fa-money-bill-wave"></i>
                      </div>
                      <div class="card-content">
                          <h4>Valor Arrecadado (Estimativa)</h4>
                          <p class="card-value" id="valorArrecadado">R$ 0,00</p>
                      </div>
                  </div>
              </div>
              
              <div class="dashboard-details">
                  <h4><i class="fas fa-chart-bar" style="color: var(--primary-color);"></i> Detalhes por Categoria e Tamanho</h4>
                  <div class="dashboard-cards" style="grid-template-columns: repeat(3, 1fr);">
                      <div class="card" style="border-left-color: #00bcd4; background-color: #e0f7fa;">
                          <div class="card-icon" style="background-color: #00bcd4;"><i class="fas fa-baby"></i></div>
                          <div class="card-content"><h4>Infantil</h4><p class="card-value" id="totalInfantis">0</p></div>
                      </div>
                      <div class="card" style="border-left-color: #e91e63; background-color: #fce4ec;">
                          <div class="card-icon" style="background-color: #e91e63;"><i class="fas fa-female"></i></div>
                          <div class="card-content"><h4>Babylook</h4><p class="card-value" id="totalBabylook">0</p></div>
                      </div>
                      <div class="card" style="border-left-color: #4caf50; background-color: #e8f5e9;">
                          <div class="card-icon" style="background-color: #4caf50;"><i class="fas fa-male"></i></div>
                          <div class="card-content"><h4>Unissex</h4><p class="card-value" id="totalUnissex">0</p></div>
                      </div>
                  </div>
                  <button class="btn btn-secondary" id="btnVerDetalhes" style="margin-top: 10px;">
                      <i class="fas fa-table"></i> Ver Detalhes por Tamanho
                  </button>
              </div>

              <div id="mensagemAdmin" class="message-container"></div>
          </div>

          <div id="admin-pedidos" class="admin-section">
              <div class="admin-section-header">
                  <h3>Lista de Pedidos</h3>
                  <button id="atualizarPedidos" class="btn-refresh">
                      <i class="fas fa-sync-alt"></i>
                      Atualizar Lista
                  </button>
              </div>
              <div id="pedidosListContainer" class="pedidos-list">
                  <div class="mensagem aviso">Nenhum pedido encontrado.</div>
              </div>
          </div>
          
          <div id="admin-detalhes-tamanhos" class="admin-section">
              <div class="admin-section-header">
                  <h3><i class="fas fa-ruler-combined"></i> Detalhes de Quantidade por Tamanho</h3>
                  <div class="pedido-actions">
                      <button id="atualizarDetalhesTamanho" class="btn-refresh">
                          <i class="fas fa-sync-alt"></i>
                          Atualizar Tabela
                      </button>
                      <button id="voltarDashboard" class="btn btn-secondary">
                          <i class="fas fa-arrow-left"></i>
                          Dashboard
                      </button>
                  </div>
              </div>
              <div id="detalhesTamanhosContainer" class="details-tamanhos-table">
                  <div class="mensagem aviso">Carregando detalhes...</div>
              </div>
          </div>

          <div id="admin-financeiro" class="admin-section">
              <div class="dashboard-header">
                  <h3>Configurações e Detalhamento Financeiro</h3>
                  <button id="atualizarFinanceiro" class="btn-refresh">
                      <i class="fas fa-sync-alt"></i>
                      Atualizar
                  </button>
              </div>

              <div class="modern-form" style="margin-bottom: 2rem;">
                  <h4><i class="fas fa-cog" style="color: var(--primary-color);"></i> Configurar Preço da Camiseta</h4>
                  <form id="formConfigPrecoCamiseta" style="margin-top: 1rem;">
                      <div class="form-grid" style="grid-template-columns: 1fr auto;">
                          <div class="form-group">
                              <label for="precoCamisetaInput">
                                  <i class="fas fa-tag"></i>
                                  Valor Unitário da Camiseta (R$)
                              </label>
                              <input type="number" id="precoCamisetaInput" step="0.01" min="0" value="0.00" required>
                          </div>
                          <div class="form-actions" style="margin-top: auto; align-self: flex-end;">
                              <button type="submit" class="btn-primary" style="padding: 0.75rem 1.5rem;">
                                  <i class="fas fa-save"></i>
                                  Salvar Preço
                              </button>
                          </div>
                      </div>
                      <div id="mensagemFinanceiroConfig" class="message-container" style="margin-top: 0;"></div>
                  </form>
                  <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 1rem;">O valor é salvo localmente no seu navegador e será usado para calcular o total arrecadado.</p>
              </div>
              
              <div class="dashboard-details">
                  <h4><i class="fas fa-file-invoice-dollar" style="color: var(--primary-color);"></i> Detalhamento por Localidade (R$)</h4>
                  <div id="detalhamentoFinanceiroBody">
                      <p style="color: var(--text-muted);">Carregando dados...</p>
                  </div>
              </div>
          </div>

          
          <div id="modalDetalhesPedido" class="admin-section" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; width: 90%; max-width: 700px; padding: 30px; border: 2px solid var(--primary-color);">
              <div class="admin-section-header">
                  <h3 id="detalhesPedidoTitulo"><i class="fas fa-receipt"></i> Detalhes do Pedido</h3>
                  <button class="btn btn-link" id="fecharDetalhesModal">
                      <i class="fas fa-times"></i> Fechar
                  </button>
              </div>
              <div id="detalhesPedidoBody" class="resumo-pedido-body">
                  </div>
              <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                  <button class="btn btn-success" id="btnAprovarPedido">
                      <i class="fas fa-check"></i> Aprovar
                  </button>
                  <button class="btn btn-danger" id="btnRejeitarPedido">
                      <i class="fas fa-ban"></i> Rejeitar
                  </button>
              </div>
              <div id="mensagemDetalhes" class="message-container"></div>
          </div>
          <div id="modalDetalhesOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; display: none;"></div>

      </div>
    </div>


  </div>

  <script type="module">
    // Firebase Config (Necessário configurar antes de usar)
    const firebaseConfig = {
        // Substitua com suas credenciais do Firebase
        apiKey: "SUA_API_KEY",
        authDomain: "SEU_PROJETO.firebaseapp.com",
        projectId: "SEU_PROJETO",
        storageBucket: "SEU_PROJETO.appspot.com",
        messagingSenderId: "SEU_MESSAGING_SENDER_ID",
        appId: "SEU_APP_ID"
    };

    // Inicializa o Firebase
    // if (!firebase.apps.length) {
    //     firebase.initializeApp(firebaseConfig);
    // }
    // const db = firebase.firestore();

    // VARIÁVEIS CRÍTICAS
    // Alerta: Remova ou altere esta senha em um ambiente real
    const ADMIN_PASSWORD_FIXA = "umademats"; // <-- **INSERIR SENHA AQUI**
    const LOCAL_STORAGE_PRECO_KEY = "umademats_preco_camiseta"; // Chave para o Local Storage
    
    // Simulação do Firestore e Inicialização
    // Usaremos um objeto simples no LocalStorage para simular o banco de dados
    const DB_KEY = 'umademats_pedidos_db';
    
    window.inicializarDB = function() {
        if (!localStorage.getItem(DB_KEY)) {
            localStorage.setItem(DB_KEY, JSON.stringify({}));
        }
    }
    window.inicializarDB();


    // ==========================================================
    // FUNÇÕES AUXILIARES
    // ==========================================================
    
    // Funções de manipulação de tela (display, loading, messages)
    window.redirecionarComAnimacao = function(secaoId) {
        document.querySelectorAll('.section-content, .admin-panel').forEach(sec => sec.style.display = 'none');
        const secao = document.getElementById(secaoId);
        if (secao) {
            secao.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
    
    window.mostrarCarregamento = function(mostrar, texto = 'Carregando...') {
        const overlay = document.getElementById('loading-overlay');
        const textSpan = document.getElementById('loading-text');
        if (mostrar) {
            textSpan.textContent = texto;
            overlay.style.display = 'flex';
        } else {
            overlay.style.display = 'none';
        }
    }

    window.exibirMensagem = function(containerId, tipo, texto) {
        const container = document.getElementById(containerId);
        const icon = tipo === 'sucesso' ? 'fas fa-check-circle' : tipo === 'erro' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
        container.innerHTML = `<div class="mensagem ${tipo}"><i class="${icon}"></i> ${texto}</div>`;
        setTimeout(() => container.innerHTML = '', 7000);
    }
    
    window.limparFormulario = function(formId) {
        const form = document.getElementById(formId);
        if (form) form.reset();
        document.querySelectorAll(`#${formId} input[type="number"]`).forEach(input => input.value = 0);
    }

    window.formatarCPF = function(cpf) {
        cpf = cpf.replace(/\D/g, ""); // Remove tudo o que não é dígito
        cpf = cpf.replace(/^(\d{3})(\d)/, "$1.$2");
        cpf = cpf.replace(/^(\d{3})\.(\d{3})(\d)/, "$1.$2.$3");
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        return cpf;
    }
    
    document.getElementById('cpf').addEventListener('input', (e) => {
        e.target.value = window.formatarCPF(e.target.value);
    });
    
    document.getElementById('cpfConsulta').addEventListener('input', (e) => {
        e.target.value = window.formatarCPF(e.target.value);
    });

    window.atualizarElemento = function(id, valor) {
        const el = document.getElementById(id);
        if (el) el.textContent = valor;
    }
    
    window.formatarMoeda = function(valor) {
        if (isNaN(valor)) return "R$ 0,00";
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // ==========================================================
    // FUNÇÕES FIREBASE (SIMULAÇÃO COM LOCALSTORAGE)
    // ==========================================================

    // Salva o pedido no DB (simulado)
    window.salvarPedidoDB = async function(pedido) {
        return new Promise((resolve) => {
            window.mostrarCarregamento(true, 'Salvando pedido...');
            const db = JSON.parse(localStorage.getItem(DB_KEY));
            
            // Usar o CPF (normalizado) como chave única
            const key = pedido.cpf.replace(/\D/g, ''); 
            
            db[key] = {
                ...pedido,
                id: key, // ID baseado no CPF para facilitar a consulta
                dataPedido: new Date().toISOString(),
                status: 'Pendente' // Status inicial
            };
            
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            setTimeout(() => { // Simula o tempo de resposta do DB
                window.mostrarCarregamento(false);
                resolve(db[key]);
            }, 500);
        });
    };

    // Consulta um pedido pelo CPF
    window.consultarPedidoDB = async function(cpf) {
        return new Promise((resolve) => {
            window.mostrarCarregamento(true, 'Buscando pedido...');
            const db = JSON.parse(localStorage.getItem(DB_KEY));
            const key = cpf.replace(/\D/g, '');
            
            setTimeout(() => {
                window.mostrarCarregamento(false);
                resolve(db[key] || null);
            }, 500);
        });
    };
    
    // Carrega todos os pedidos
    window.carregarTodosPedidos = async function() {
        return new Promise((resolve) => {
            const db = JSON.parse(localStorage.getItem(DB_KEY));
            const pedidos = Object.values(db || {});
            // Ordena do mais novo para o mais antigo
            pedidos.sort((a, b) => new Date(b.dataPedido) - new Date(a.dataPedido));
            resolve(pedidos);
        });
    };
    
    // Atualiza o status de um pedido
    window.atualizarStatusPedidoDB = async function(id, novoStatus) {
        return new Promise((resolve, reject) => {
            const db = JSON.parse(localStorage.getItem(DB_KEY));
            if (db[id]) {
                db[id].status = novoStatus;
                localStorage.setItem(DB_KEY, JSON.stringify(db));
                resolve(db[id]);
            } else {
                reject(new Error("Pedido não encontrado."));
            }
        });
    };

    // ==========================================================
    // FUNÇÕES DE FLUXO DO USUÁRIO
    // ==========================================================

    window.handleFazerPedido = async function(e) {
        e.preventDefault();
        window.mostrarCarregamento(true, 'Processando pedido...');

        const form = e.target;
        const nome = form.nome.value.trim();
        const cpf = form.cpf.value.trim();
        const local = form.local.value.trim();
        const setor = form.setor.value.trim();
        
        // 1. Coleta e validação dos tamanhos
        const tamanhos = ['2', '4', '6', '8', '10', '12', 'p', 'm', 'g', 'gg', 'xg', 'g1'];
        const infantil = {};
        const babylook = {};
        const unissex = {};
        let totalCamisetas = 0;
        
        tamanhos.forEach(t => {
            const inf = parseInt(document.getElementById(`infantil_${t}`)?.value || 0);
            const bb = parseInt(document.getElementById(`babylook_${t}`)?.value || 0);
            const uni = parseInt(document.getElementById(`unissex_${t}`)?.value || 0);
            
            if (inf > 0) infantil[t] = inf;
            if (bb > 0) babylook[t] = bb;
            if (uni > 0) unissex[t] = uni;
            
            totalCamisetas += (inf + bb + uni);
        });
        
        if (totalCamisetas === 0) {
            window.mostrarCarregamento(false);
            window.exibirMensagem('mensagemPedido', 'erro', 'Você deve pedir pelo menos uma camiseta.');
            return;
        }

        // 2. Monta o objeto pedido
        const novoPedido = {
            nome,
            cpf,
            local,
            setor,
            infantil,
            babylook,
            unissex,
            totalCamisetas
        };
        
        try {
            // 3. Salva no DB (simulado)
            const pedidoSalvo = await window.salvarPedidoDB(novoPedido);
            
            // 4. Exibe a tela de confirmação
            window.exibirConfirmacaoPedido(pedidoSalvo);
            window.limparFormulario('formPedido');
            
        } catch (error) {
            window.mostrarCarregamento(false);
            console.error("Erro ao salvar o pedido:", error);
            window.exibirMensagem('mensagemPedido', 'erro', `Erro ao finalizar pedido: ${error.message}`);
        }
    }
    
    // Exibe a tela de confirmação (após o envio)
    window.exibirConfirmacaoPedido = function(pedido) {
        window.redirecionarComAnimacao('confirmacao-pedido');
        
        // **INÍCIO DA LÓGICA DE CÁLCULO DE VALOR (COMO NA CONSULTA)**
        const precoCamisetaString = localStorage.getItem(LOCAL_STORAGE_PRECO_KEY);
        const precoCamiseta = parseFloat(precoCamisetaString) || 0.00;
        const valorTotal = pedido.totalCamisetas * precoCamiseta;
        // **FIM DA LÓGICA DE CÁLCULO DE VALOR**

        const resumoHtml = window.gerarResumoPedidoHtml(pedido, pedido.status, valorTotal);
        document.getElementById('confirmacaoPedidoBody').innerHTML = resumoHtml;
    }
    
    window.fecharConfirmacaoPedido = function() {
        window.redirecionarComAnimacao('home');
    }

    // Lida com a consulta de pedido pelo CPF
    window.handleConsultaPedido = async function(e) {
        e.preventDefault();
        const cpfConsulta = document.getElementById('cpfConsulta').value.trim();
        if (!cpfConsulta) return;
        
        try {
            const pedido = await window.consultarPedidoDB(cpfConsulta);

            if (pedido) {
                document.getElementById('formConsulta').style.display = 'none';
                document.getElementById('resumoPedido').style.display = 'block';
                window.exibirPedido(pedido);
            } else {
                window.exibirMensagem('mensagemConsulta', 'erro', 'Nenhum pedido encontrado para o CPF informado.');
                document.getElementById('formConsulta').style.display = 'block';
                document.getElementById('resumoPedido').style.display = 'none';
            }
        } catch (error) {
            console.error("Erro ao consultar o pedido:", error);
            window.exibirMensagem('mensagemConsulta', 'erro', 'Ocorreu um erro ao buscar o pedido. Tente novamente.');
        }
    }
    
    // Função MODIFICADA para exibir o resumo do pedido (agora inclui o valor)
    window.exibirPedido = function(pedido) {
        const resumoElement = document.getElementById('resumoPedidoBody');
        
        // **INÍCIO DA LÓGICA DE CÁLCULO DE VALOR (NOVO)**
        const precoCamisetaString = localStorage.getItem(LOCAL_STORAGE_PRECO_KEY);
        const precoCamiseta = parseFloat(precoCamisetaString) || 0.00;
        const valorTotal = pedido.totalCamisetas * precoCamiseta;
        // **FIM DA LÓGICA DE CÁLCULO DE VALOR**

        const resumoHtml = window.gerarResumoPedidoHtml(pedido, pedido.status, valorTotal);
        resumoElement.innerHTML = resumoHtml;
    }
    
    // Função auxiliar para gerar o HTML do resumo (usada na Confirmação e na Consulta)
    window.gerarResumoPedidoHtml = function(pedido, status, valorTotal) {
        const statusClass = `status-${status}`;
        const dataFormatada = pedido.dataPedido ? new Date(pedido.dataPedido).toLocaleDateString('pt-BR', { timeZone: 'UTC' }) : 'N/A';
        
        let tamanhosHtml = '';
        
        const categorias = [
            { nome: 'Infantil', dados: pedido.infantil },
            { nome: 'Babylook', dados: pedido.babylook },
            { nome: 'Unissex', dados: pedido.unissex }
        ];

        categorias.forEach(cat => {
            if (cat.dados && Object.keys(cat.dados).length > 0) {
                tamanhosHtml += `<h4>${cat.nome}</h4>`;
                tamanhosHtml += '<table><thead><tr><th>Tamanho</th><th>Qtd</th></tr></thead><tbody>';
                for (const [tamanho, qtd] of Object.entries(cat.dados)) {
                    tamanhosHtml += `<tr><td>${tamanho.toUpperCase()}</td><td>${qtd}</td></tr>`;
                }
                tamanhosHtml += '</tbody></table>';
            }
        });

        return `
            <div class="resumo-detail-item">
                <span class="label">Nome:</span>
                <span class="value">${pedido.nome}</span>
            </div>
            <div class="resumo-detail-item">
                <span class="label">CPF:</span>
                <span class="value">${pedido.cpf}</span>
            </div>
            <div class="resumo-detail-item">
                <span class="label">Local (Cidade/Setor):</span>
                <span class="value">${pedido.local} / ${pedido.setor}</span>
            </div>
            <div class="resumo-detail-item">
                <span class="label">Data do Pedido:</span>
                <span class="value">${dataFormatada}</span>
            </div>
            <div class="resumo-detail-item">
                <span class="label">Status:</span>
                <span class="value"><span class="pedido-status ${statusClass}">${status}</span></span>
            </div>
            <div class="resumo-detail-item">
                <span class="label">Total de Camisetas:</span>
                <span class="value">${pedido.totalCamisetas}</span>
            </div>
            <div class="resumo-detail-item total-value-line">
                <span class="label">Valor Estimado das Camisetas:</span>
                <span class="value price-value">${window.formatarMoeda(valorTotal)}</span>
            </div>
            
            <div class="resumo-tamanhos" style="margin-top: 20px;">
                <h3 style="font-weight: 700; color: var(--dark-color); margin-bottom: 10px;">Detalhes por Tamanho</h3>
                ${tamanhosHtml}
            </div>
        `;
    }

    // ==========================================================
    // FUNÇÕES DE FLUXO DO ADMINISTRADOR
    // ==========================================================
    
    // Função para fazer login no admin
    window.handleAdminLogin = function() {
        const senha = prompt("Digite a senha de administrador:");
        if (senha === ADMIN_PASSWORD_FIXA) {
            document.getElementById('home').style.display = 'none';
            document.getElementById('fazer-pedido').style.display = 'none';
            document.getElementById('consulta-pedido').style.display = 'none';
            document.getElementById('confirmacao-pedido').style.display = 'none';
            document.getElementById('painelAdmin').style.display = 'flex';
            window.carregarDashboard();
            window.carregarPrecoCamiseta(); // Carrega o preço ao entrar no admin

        } else if (senha !== null && senha !== "") {
            window.exibirMensagem('mensagemHome', 'erro', 'Senha incorreta.');
        }
    }
    
    // Função para sair do admin
    window.handleAdminLogout = function() {
        document.getElementById('painelAdmin').style.display = 'none';
        window.redirecionarComAnimacao('home');
    }
    
    // Alterna a seção visível no Admin Panel
    window.mostrarAdminSecao = function(secao) {
        document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
        document.querySelectorAll('.admin-menu-btn').forEach(btn => btn.classList.remove('active'));

        document.getElementById(`admin-${secao}`).classList.add('active');
        document.getElementById(`btn${secao.charAt(0).toUpperCase() + secao.slice(1)}`).classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // Ações específicas ao mudar de seção
        if (secao === 'pedidos') {
            window.carregarPedidos();
        } else if (secao === 'dashboard') {
            window.carregarDashboard();
        } else if (secao === 'financeiro') {
            window.carregarPrecoCamiseta();
            window.carregarDetalhesFinanceiro();
        }
    }

    // DASHBOARD (Função MODIFICADA para incluir o Valor Arrecadado)
    window.carregarDashboard = async function() {
        window.mostrarCarregamento(true, 'Calculando visão geral...');
        
        try {
            const pedidos = await window.carregarTodosPedidos();
            
            // NOVO: Carrega o preço da camiseta
            const precoCamiseta = window.carregarPrecoCamiseta();

            let totalPedidos = pedidos.length;
            let totalCamisetas = 0;
            let pedidosPendentes = 0;
            let pedidosAprovados = 0;
            let pedidosRejeitados = 0;
            let totalInfantis = 0;
            let totalBabylook = 0;
            let totalUnissex = 0;

            pedidos.forEach(pedido => {
                const infantilCount = Object.values(pedido.infantil || {}).reduce((a, b) => a + b, 0);
                const babylookCount = Object.values(pedido.babylook || {}).reduce((a, b) => a + b, 0);
                const unissexCount = Object.values(pedido.unissex || {}).reduce((a, b) => a + b, 0);

                totalInfantis += infantilCount;
                totalBabylook += babylookCount;
                totalUnissex += unissexCount;
                totalCamisetas += infantilCount + babylookCount + unissexCount;

                if (pedido.status === 'Pendente') pedidosPendentes++;
                else if (pedido.status === 'Aprovado') pedidosAprovados++;
                else if (pedido.status === 'Rejeitado') pedidosRejeitados++;
            });
            
            // NOVO: Cálculo do Valor Arrecadado
            const valorArrecadado = totalCamisetas * precoCamiseta;

            window.atualizarElemento('totalPedidos', totalPedidos);
            window.atualizarElemento('totalCamisetas', totalCamisetas);
            window.atualizarElemento('pedidosPendentes', pedidosPendentes);
            window.atualizarElemento('pedidosAprovados', pedidosAprovados);
            window.atualizarElemento('totalInfantis', totalInfantis);
            window.atualizarElemento('totalBabylook', totalBabylook);
            window.atualizarElemento('totalUnissex', totalUnissex);
            window.atualizarElemento('pedidosRejeitados', pedidosRejeitados);
            
            // NOVO: Atualiza o card de valor arrecadado
            window.atualizarElemento('valorArrecadado', formatarMoeda(valorArrecadado));
            
            window.mostrarCarregamento(false);
            
        } catch (error) {
            console.error(`Erro ao carregar Dashboard:`, error);
            window.exibirMensagem('mensagemAdmin', 'erro', `Erro ao carregar dashboard: ${error.message}.`);
            window.mostrarCarregamento(false);
        }
    };
    
    // PEDIDOS (Admin)
    window.carregarPedidos = async function() {
        window.mostrarCarregamento(true, 'Carregando lista de pedidos...');
        const container = document.getElementById('pedidosListContainer');
        container.innerHTML = '';
        
        try {
            const pedidos = await window.carregarTodosPedidos();

            if (pedidos.length === 0) {
                container.innerHTML = '<div class="mensagem aviso"><i class="fas fa-info-circle"></i> Nenhum pedido encontrado no sistema.</div>';
                window.mostrarCarregamento(false);
                return;
            }

            pedidos.forEach(pedido => {
                const statusClass = `status-${pedido.status}`;
                const dataFormatada = new Date(pedido.dataPedido).toLocaleDateString('pt-BR', { timeZone: 'UTC' });
                
                const itemHtml = `
                    <div class="pedido-item" data-id="${pedido.id}">
                        <div class="pedido-info">
                            <h5>${pedido.nome} - ${pedido.cpf}</h5>
                            <p>${pedido.local} / ${pedido.setor} | Camisetas: ${pedido.totalCamisetas} | Data: ${dataFormatada}</p>
                        </div>
                        <div class="pedido-actions">
                            <span class="pedido-status ${statusClass}">${pedido.status}</span>
                            <button class="btn btn-secondary btn-sm" onclick="window.abrirDetalhesPedido('${pedido.id}')">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += itemHtml;
            });
            window.mostrarCarregamento(false);
            
        } catch (error) {
            console.error("Erro ao carregar pedidos:", error);
            container.innerHTML = '<div class="mensagem erro"><i class="fas fa-exclamation-circle"></i> Erro ao carregar a lista de pedidos.</div>';
            window.mostrarCarregamento(false);
        }
    }

    // Ações do Modal de Detalhes
    window.abrirDetalhesPedido = async function(id) {
        window.mostrarCarregamento(true, 'Carregando detalhes do pedido...');
        const pedido = await window.consultarPedidoDB(id);
        
        if (!pedido) {
            window.mostrarCarregamento(false);
            window.exibirMensagem('mensagemDetalhes', 'erro', 'Pedido não encontrado.');
            return;
        }

        // **INÍCIO DA LÓGICA DE CÁLCULO DE VALOR (NOVO)**
        const precoCamisetaString = localStorage.getItem(LOCAL_STORAGE_PRECO_KEY);
        const precoCamiseta = parseFloat(precoCamisetaString) || 0.00;
        const valorTotal = pedido.totalCamisetas * precoCamiseta;
        // **FIM DA LÓGICA DE CÁLCULO DE VALOR**

        const resumoHtml = window.gerarResumoPedidoHtml(pedido, pedido.status, valorTotal);
        
        document.getElementById('detalhesPedidoTitulo').innerHTML = `<i class="fas fa-receipt"></i> Pedido de ${pedido.nome}`;
        document.getElementById('detalhesPedidoBody').innerHTML = resumoHtml;
        
        // Configura botões de status
        document.getElementById('btnAprovarPedido').onclick = () => window.alterarStatusPedido(id, 'Aprovado');
        document.getElementById('btnRejeitarPedido').onclick = () => window.alterarStatusPedido(id, 'Rejeitado');
        
        // Exibe modal
        document.getElementById('modalDetalhesPedido').style.display = 'block';
        document.getElementById('modalDetalhesOverlay').style.display = 'block';
        window.mostrarCarregamento(false);
    }

    window.fecharDetalhesPedido = function() {
        document.getElementById('modalDetalhesPedido').style.display = 'none';
        document.getElementById('modalDetalhesOverlay').style.display = 'none';
        window.exibirMensagem('mensagemDetalhes', 'erro', ''); // Limpa mensagem
    }

    window.alterarStatusPedido = async function(id, novoStatus) {
        window.mostrarCarregamento(true, `Atualizando status para ${novoStatus}...`);
        try {
            await window.atualizarStatusPedidoDB(id, novoStatus);
            window.exibirMensagem('mensagemDetalhes', 'sucesso', `Status atualizado para ${novoStatus}!`);
            window.carregarPedidos(); // Recarrega a lista
            window.carregarDashboard(); // Recarrega o dashboard
            setTimeout(window.fecharDetalhesPedido, 1000); // Fecha após 1s
        } catch (error) {
            window.mostrarCarregamento(false);
            window.exibirMensagem('mensagemDetalhes', 'erro', `Erro ao atualizar status: ${error.message}`);
        }
    }
    
    // Detalhes por Tamanho (Tabela)
    window.carregarDetalhesTamanho = async function() {
        window.mostrarCarregamento(true, 'Gerando tabela de tamanhos...');
        const container = document.getElementById('detalhesTamanhosContainer');
        container.innerHTML = '';
        
        try {
            const pedidos = await window.carregarTodosPedidos();
            const totais = {};
            let totalGeral = 0;

            const categorias = ['infantil', 'babylook', 'unissex'];
            const tamanhos = {
                'infantil': ['2', '4', '6', '8', '10', '12'],
                'babylook': ['p', 'm', 'g', 'gg', 'xg', 'g1'],
                'unissex': ['p', 'm', 'g', 'gg', 'xg', 'g1']
            };

            categorias.forEach(cat => {
                totais[cat] = {};
                tamanhos[cat].forEach(t => totais[cat][t] = 0);
            });

            pedidos.forEach(pedido => {
                categorias.forEach(cat => {
                    const dados = pedido[cat] || {};
                    for (const t in dados) {
                        if (totais[cat][t] !== undefined) {
                            totais[cat][t] += dados[t];
                            totalGeral += dados[t];
                        }
                    }
                });
            });

            let htmlTabela = '';
            
            categorias.forEach(cat => {
                const catNome = cat.charAt(0).toUpperCase() + cat.slice(1);
                
                let totalCat = Object.values(totais[cat]).reduce((a, b) => a + b, 0);

                htmlTabela += `
                    <h4>${catNome} (Total: ${totalCat})</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Tamanho</th>
                                <th>Quantidade</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                tamanhos[cat].forEach(t => {
                    htmlTabela += `
                        <tr>
                            <td>${t.toUpperCase()}</td>
                            <td>${totais[cat][t]}</td>
                        </tr>
                    `;
                });
                htmlTabela += `</tbody></table>`;
            });
            
            container.innerHTML = `<h3>TOTAL GERAL DE CAMISETAS: ${totalGeral}</h3>` + htmlTabela;
            window.mostrarCarregamento(false);

        } catch (error) {
            console.error("Erro ao carregar detalhes de tamanhos:", error);
            container.innerHTML = '<div class="mensagem erro"><i class="fas fa-exclamation-circle"></i> Erro ao carregar detalhes de tamanhos.</div>';
            window.mostrarCarregamento(false);
        }
    }
    
    // === FUNÇÕES FINANCEIRAS (NOVO) ===

    // Salva o preço no Local Storage
    window.salvarPrecoCamiseta = function(e) {
        e.preventDefault();
        const precoInput = document.getElementById('precoCamisetaInput');
        const preco = parseFloat(precoInput.value);
        
        if (isNaN(preco) || preco < 0) {
            window.exibirMensagem('mensagemFinanceiroConfig', 'erro', 'O valor deve ser um número positivo.');
            return;
        }

        try {
            localStorage.setItem(LOCAL_STORAGE_PRECO_KEY, preco.toFixed(2));
            window.exibirMensagem('mensagemFinanceiroConfig', 'sucesso', `Preço salvo: ${window.formatarMoeda(preco)}. Atualize o Dashboard para ver o novo cálculo.`);
            
            // Atualiza imediatamente o input com o valor formatado
            precoInput.value = preco.toFixed(2);
            
            // Recalcula o dashboard após salvar o preço
            window.carregarDashboard();

        } catch (error) {
            window.exibirMensagem('mensagemFinanceiroConfig', 'erro', 'Erro ao salvar o preço.');
        }
    };

    // Carrega o preço do Local Storage
    window.carregarPrecoCamiseta = function() {
        const precoString = localStorage.getItem(LOCAL_STORAGE_PRECO_KEY);
        const preco = parseFloat(precoString) || 0.00; // Valor padrão de 0
        const inputElement = document.getElementById('precoCamisetaInput');
        if (inputElement) {
            inputElement.value = preco.toFixed(2);
        }
        return preco;
    };

    // Carrega o detalhamento financeiro por localidade
    window.carregarDetalhesFinanceiro = async function() {
        window.mostrarCarregamento(true, 'Calculando detalhamento financeiro...');
        const detalhesElement = document.getElementById('detalhamentoFinanceiroBody');
        detalhesElement.innerHTML = '<p style="color: var(--text-muted);">Calculando...</p>';
        
        try {
            const precoCamiseta = window.carregarPrecoCamiseta();
            const pedidos = await window.carregarTodosPedidos();
            
            const totaisPorLocal = {};
            let totalGeral = 0;
            
            pedidos.forEach(pedido => {
                const localKey = `${pedido.setor} (${pedido.local})`;
                const totalCamisetas = pedido.totalCamisetas; // Já calculado no objeto pedido
                
                const valorTotal = totalCamisetas * precoCamiseta;

                totaisPorLocal[localKey] = (totaisPorLocal[localKey] || 0) + valorTotal;
                totalGeral += valorTotal;
            });

            let htmlContent = `<div class="details-grid">`;
            
            // Ordena por valor decrescente
            const locaisOrdenados = Object.entries(totaisPorLocal).sort(([, a], [, b]) => b - a);
            
            if (locaisOrdenados.length === 0) {
                detalhesElement.innerHTML = '<div class="mensagem aviso"><i class="fas fa-info-circle"></i> Nenhum pedido com valor encontrado.</div>';
                window.mostrarCarregamento(false);
                return;
            }


            locaisOrdenados.forEach(([local, valor]) => {
                htmlContent += `
                    <div class="detail-item">
                        <div class="detail-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="detail-content" style="flex-direction: column; align-items: flex-start;">
                            <span style="font-weight: 600;">${local}</span>
                            <strong style="color: var(--primary-color); font-size: 1.25rem;">${window.formatarMoeda(valor)}</strong>
                        </div>
                    </div>
                `;
            });
            
            htmlContent += `</div>`;
            
            detalhesElement.innerHTML = htmlContent;
            
        } catch (error) {
            console.error('Erro ao carregar detalhes financeiros:', error);
            detalhesElement.innerHTML = `<div class="mensagem erro"><i class="fas fa-exclamation-circle"></i> Erro ao carregar detalhes: ${error.message}</div>`;
        } finally {
            window.mostrarCarregamento(false);
        }
    };


    // ==========================================================
    // EVENT LISTENERS GLOBAIS
    // ==========================================================
    document.addEventListener('DOMContentLoaded', () => {
      window.mostrarCarregamento(false); // Esconde no carregamento inicial
      
      // Fluxo do Usuário
      document.getElementById('btnFazerPedido').addEventListener('click', () => window.redirecionarComAnimacao('fazer-pedido'));
      document.getElementById('btnConsultarPedido').addEventListener('click', () => window.redirecionarComAnimacao('consulta-pedido'));
      document.getElementById('btnCancelarPedido').addEventListener('click', () => window.redirecionarComAnimacao('home'));
      document.getElementById('formPedido').addEventListener('submit', window.handleFazerPedido);
      document.getElementById('formConsulta').addEventListener('submit', window.handleConsultaPedido);
      document.getElementById('fecharResumoConsulta').addEventListener('click', () => {
          document.getElementById('formConsulta').style.display = 'block';
          document.getElementById('resumoPedido').style.display = 'none';
          document.getElementById('cpfConsulta').value = '';
          document.getElementById('mensagemConsulta').innerHTML = '';
      });

      // Fluxo da Confirmação/Volta
      document.getElementById('fecharConfirmacaoPedido').addEventListener('click', () => window.fecharConfirmacaoPedido());
      document.getElementById('voltarHomeConsulta').addEventListener('click', () => window.redirecionarComAnimacao('home'));
      
      // Fluxo do Administrador (Botões Principais)
      document.getElementById('btnAdminAccess').addEventListener('click', window.handleAdminLogin);
      document.getElementById('btnLogoutAdmin').addEventListener('click', window.handleAdminLogout);
      document.getElementById('btnDashboard').addEventListener('click', () => window.mostrarAdminSecao('dashboard'));
      document.getElementById('btnPedidos').addEventListener('click', () => window.mostrarAdminSecao('pedidos'));
      
      // Dashboard/Detalhes
      document.getElementById('atualizarDashboard').addEventListener('click', window.carregarDashboard);
      document.getElementById('atualizarPedidos').addEventListener('click', window.carregarPedidos);
      
      const btnVerDetalhes = document.getElementById('btnVerDetalhes');
      const voltarDashboard = document.getElementById('voltarDashboard');
      const atualizarDetalhesTamanho = document.getElementById('atualizarDetalhesTamanho');

      if (btnVerDetalhes) {
          btnVerDetalhes.addEventListener('click', () => {
              window.mostrarAdminSecao('detalhes-tamanhos'); 
              window.carregarDetalhesTamanho(); 
          });
      }
      if (voltarDashboard) {
          voltarDashboard.addEventListener('click', () => {
              window.mostrarAdminSecao('dashboard');
          });
      }
      if (atualizarDetalhesTamanho) {
          atualizarDetalhesTamanho.addEventListener('click', window.carregarDetalhesTamanho);
      }
      
      // Modal de Detalhes do Pedido
      document.getElementById('fecharDetalhesModal').addEventListener('click', window.fecharDetalhesPedido);

      // === Fluxo do Administrador (Financeiro) ===
      const btnFinanceiro = document.getElementById('btnFinanceiro');
      const formConfigPrecoCamiseta = document.getElementById('formConfigPrecoCamiseta');
      const atualizarFinanceiro = document.getElementById('atualizarFinanceiro');

      if (btnFinanceiro) {
          btnFinanceiro.addEventListener('click', () => {
              window.mostrarAdminSecao('financeiro');
              window.carregarPrecoCamiseta(); // Carrega o preço salvo ao abrir a tela
              window.carregarDetalhesFinanceiro();
          });
      }
      
      if (formConfigPrecoCamiseta) {
          formConfigPrecoCamiseta.addEventListener('submit', window.salvarPrecoCamiseta);
      }
      
      if (atualizarFinanceiro) {
          atualizarFinanceiro.addEventListener('click', window.carregarDetalhesFinanceiro);
      }
      
      // Carrega o preço no input ao iniciar (para usuários que acessam o Admin)
      if (document.getElementById('precoCamisetaInput')) {
          window.carregarPrecoCamiseta();
      }
    });

  </script>
</body>
</html>
